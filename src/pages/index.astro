---
import Head from '../components/Head.astro';
import Nav from '../components/Nav.astro';
import CenteredLayout from '../components/CenteredLayout.astro';
import PostPreview from '../components/PostPreview.astro';
import Pagination from '../components/Pagination.astro';
import { env } from '../environment';
import { CMS } from '../models/cms';

// page
const { title, description } = env;

// collection
// note: we want to show first 3 posts here, but we donâ€™t want to paginate at /1, /2, /3, etc.
const allPosts: CMS.Post[] = Astro.fetchContent('./posts/*.md');
allPosts.sort((a, b) => new Date(b.date).valueOf() - new Date(a.date).valueOf());
const firstPage = allPosts.slice(0, 3);
---

<!DOCTYPE html>
<html>
  <head>
    <Head
      title={title}
      description={description}
      image={firstPage[0].cover}
      canonicalURL={Astro.request.canonicalURL.href}
    />
    <style>
      #grid-main {
        padding: var(--doc-padding) var(--gutter);
        display: flex;
        flex-direction: column;
        height: 100%;
      }
    </style>
  </head>

  <body>
    <Nav />

    <CenteredLayout>
      <div id="grid-main">
        {firstPage.map((post) => <PostPreview post={post} />)}
      </div>
    </CenteredLayout>

    <footer>
      <Pagination nextUrl="/posts/2" />
    </footer>
  </body>
</html>
